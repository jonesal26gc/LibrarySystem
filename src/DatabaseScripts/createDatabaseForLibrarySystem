bteq <<EOI
.LOGON 127.0.0.1/dbc,dbc;
------------------------------------- start of job -------------------------------------

------------------------------------------------------------------------------------------
-- This SQL creates all the tables in the LIBRARY database, and the LIBRARY database itself.
------------------------------------------------------------------------------------------

modify database LIBRARY as drop default journal table;
DELETE DATABASE LIBRARY;
DROP DATABASE LIBRARY;
CREATE DATABASE LIBRARY
as
   perm  = 10000000
   spool = 20000000
   fallback
   account= 'dbc'

;

CREATE TABLE LIBRARY.hibernate_sequences
    (   sequence_name           varchar(128) NOT NULL,
	    next_val  integer      NOT NULL,
	    constraint sequence_name_PK PRIMARY KEY (sequence_name)
)
;

CREATE TABLE LIBRARY.address
    (   address_id              integer      NOT NULL,
	    building_name           VARCHAR(40),
	    street_name_line_1      VARCHAR(40)  NOT NULL,
	    street_name_line_2      VARCHAR(40),
        town                    VARCHAR(40)  NOT NULL,
        city                    VARCHAR(40)  NOT NULL,
        postcode                VARCHAR(10)  NOT NULL,
        country                 CHAR(3)      NOT NULL,
	    created_timestamp       timestamp    not null,
	    modified_timestamp      timestamp,
	    constraint address_id_PK PRIMARY KEY (address_id)
)
;

CREATE TABLE LIBRARY.member
    (   member_id               integer      NOT NULL,
	    surname                 VARCHAR(40)  NOT NULL,
	    forename                varchar(40)  not null,
	    date_of_birth           date         not null,
	    gender_code             char(1)      not null,
	    address_id              integer      not null,
	    active_indicator        char(1)      not null,
	    created_timestamp       timestamp    not null,
	    modified_timestamp      timestamp,
        constraint member_id_PK PRIMARY KEY (member_id)
)
;

CREATE TABLE LIBRARY.BOOK
    (   book_id                 integer      NOT NULL,
	    book_title              VARCHAR(80)  NOT NULL,
	    author                  varchar(80)  not null,
	    publication_version     varchar (10) not null,
	    publication_date        date         not null,
	    cost_price              decimal(7,2) not null,
	    book_category_id        integer      not null,
	    book_subject_id         integer      not null,
   	    created_timestamp       timestamp    not null,
   	    modified_timestamp      timestamp,
        constraint book_id_PK PRIMARY KEY (book_id)
)
;

--ALTER TABLE LIBRARY.BOOK ADD CONSTRAINT book_category_id_FK FOREIGN KEY (book_category_id) REFERENCES LIBRARY.book_catregory (book_category_id)
--;

CREATE TABLE LIBRARY.BORROWED_BOOK
    (   borrowedBookId        integer      NOT NULL,
	    book_id                 integer      NOT NULL,
	    member_id               integer      not null,
	    active_indicator        char(1)      not null,
	    out_date                timestamp    not null,
	    in_date                 timestamp,
        constraint borrowed_book_id_PK PRIMARY KEY (borrowedBookId)
)
;

create unique index borrowed_book_SK_1
    ( member_id, borrowedBookId ) on library.borrowed_book;

create index borrowed_book_SK_2
    ( book_id, out_date ) on library.borrowed_book;

CREATE TABLE LIBRARY.address_id_SEQ
   ( address_id INTEGER NOT NULL )
   ;

CREATE TABLE LIBRARY.member_id_SEQ
   ( member_id INTEGER NOT NULL )
   ;

CREATE TABLE LIBRARY.book_id_SEQ
   ( book_id INTEGER NOT NULL )
   ;

CREATE TABLE LIBRARY.borrowed_book_id_SEQ
   ( borrowedBookId INTEGER NOT NULL )
   ;

------------------------------------- end of job ---------------------------------------
.LOGOFF;
.QUIT;
EOI
